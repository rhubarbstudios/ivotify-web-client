<div class="admin candidates index page">

<!-- Large Screen Nav -->
  <div class="navbar-fixed hide-on-med-and-down">
    <nav class="admin-nav">
      <div class="container">
        <div class="row">
          <div class="col s8">
            <a class="btn" id="admin-nav-btn" ui-sref='admin.issues'>Issues</a>
            <a class="btn" id="admin-nav-candidate" ui-sref='admin.candidates'>Candidates</a>
          </div>
          <div class="col s4 right-align">
            <a class="btn" id="add-candidate" ng-click="addCandidate = true; addNewQuote(candidate)" rel="leanModal" href="#candidate-modal"> + Candidates</a>
         </div>
        </div>
      </div>
    </nav>
  </div>

  <!-- Tablet and Smaller Nav -->
  <div class="navbar-fixed hide-on-large-only">
    <nav class="admin-nav">
      <div class="container">
        <div class="row">
          <div class="col s9">
            <a class="btn" id="admin-nav-btn" ui-sref='admin.issues'>Issues</a>
            <a class="btn" id="admin-nav-candidate" ui-sref='admin.candidates'>Candidates</a>
          </div>
          <div class="col s3 right-align">
            <a class="btn" id="add-candidate-mobile" ng-click="addCandidate = true; addNewQuote(candidate)" rel="leanModal" href="#candidate-modal">+</a>
         </div>
        </div>
      </div>
    </nav>
  </div>

<!-- Index View of Candidates -->
  <div class="container">
    <div>
      <table id="candidate-list" class="bordered responsive-table">
        <tr>
          <th>First Name</th>
          <th>Last Name</th>
          <th>Bio</th>
          <th>Last Updated</th>
        </tr>

        <tr class="candidate-row" ng-repeat-start="candidate in candidates" repeat-done="initModals()">
          <form name="candidate_edit_form" novalidate>
            <td id="candidateFirst">
              <span ng-hide="editCandidate">{{candidate.first_name}}</span>
              <textarea ng-show="editCandidate" type="text" class="validate" ng-model="candidate.first_name" required></textarea>
            </td>
            <td>
              <span ng-hide="editCandidate">{{candidate.last_name}}</span>
              <textarea ng-show="editCandidate" type="text" class="validate" ng-model="candidate.last_name" required></textarea>
            </td>
            <td>
              <span ng-hide="editCandidate">{{candidate.bio}}</span>
              <textarea ng-show="editCandidate" type="text" class="validate" ng-model="candidate.bio" required></textarea>
            </td>
            <td>
              {{candidate.updated_at | date:"MM/dd/yyyy 'at' h:mma" }}
            </td>
            <td>
              <button class="btn" id="edit-all" ng-click="editCandidate = true; addNewQuote(candidate)" ng-hide="editCandidate">Edit</button>
              <button class="btn waves-effect waves-light" id="save-all" ng-show="editCandidate" ng-click="update(candidate); editCandidate = false" ng-disabled="candidate_edit_form.$invalid" type="submit" name="action">Save</button>
              <a class="btn" id="delete-button" rel="leanModal" href="#delete-cand-modal" ng-click="getCandidateToDelete($index, candidate)" type="submit">Delete</a>
            </td>
          </form>
        </tr>


        <tr ng-repeat-end>
          <td class="quotes-row" colspan="4">
            <ul class="collapsible" data-collapsible="expandable" rel="collapsible">
              <li>
                <div class="collapsible-header">{{candidate.first_name}}'s Quotes</div>
                <div class="collapsible-body active">
                  <table>
                    <tr>
                      <th>Issue</th>
                      <th>Quote</th>
                      <th>Source</th>
                      <th>Last Updated</th>
                    </tr>
                    <tr ng-repeat="quote in candidate.quotes" on-finish-render="ngRepeatFinished">
                      <td>
                        <span ng-hide="editCandidate" ng-repeat="issue in issues | filter:{id:quote.issue_id}">{{issue.title}}</span>
                        <select ng-show="editCandidate" class="browser-default" name="repeatSelect" id="repeatSelect" ng-model="quote.issue_id"
                          ng-options="issue.id as issue.title for issue in issues">
                        </select>
                      </td>
                      <td>
                        <span ng-hide="editCandidate">{{quote.body}}</span>
                        <textarea ng-show="editCandidate" type="text" ng-model="quote.body" required></textarea>
                      </td>
                      <td>
                        <span ng-hide="editCandidate">{{quote.source}}</span>
                        <textarea ng-show="editCandidate" type="text" ng-model="quote.source" required></textarea>
                      </td>
                      <td>
                        <span>{{quote.updated_at | date:"MM/dd/yyyy 'at' h:mma" }}</span>
                      </td>
                      <td ng-show="editCandidate">
                        <button class="btn float-right" ng-show="$last" ng-click="addNewQuote(candidate)" type="button">+</button>
                      </td>
                    </tr>
                  </table>
                </div>
              </li>
            </ul>
          </td>
        </tr>

      </table>
    </div>
  </div>

  <!-- Create Candidate Modals -->
  <div class="modal" id="candidate-modal">
    <div class="modal-content">

 <!-- Create Candidate Form -->
        <form class="col s6 l12" ng-show="addCandidate" name="candidate_form" novalidate ng-submit="save()">
          <div class="row">
            <div class="col s12">
              <h4>New Candidate</h4>
            </div>
          </div>
          <div class="row">
            <div class=" input-field col s12">
              <input id="firstname" type="text" class="validate" ng-model="candidate.first_name" required/>
              <label for="firstname">First Name</label>
            </div>
          </div>
          <div class="row">
            <div class="input-field col s12">
              <input id="lastname" type="text" class="validate" ng-model="candidate.last_name" required/>
              <label for="lastname">Last Name</label>
            </div>
          </div>
          <div class="row">
            <div class=" input-field col s12">
              <input id="bio" type="text" class="validate" ng-model="candidate.bio" required/>
              <label for="bio">Bio</label>
            </div>
          </div>

          <div class="row">
            <div class="col s12">
              <h5>Quotes</h5>
            </div>
          </div>

          <div class="form-group" data-ng-repeat="quote in candidate.quotes">
            <div class="new-quote-container">
              <div class="row">
                <div class=" input-field col s12 l6">
                  <select class="browser-default" name="new-quote-select" id="new-quote-select" ng-model="quote.issue_id"
                    ng-options="issue.id as issue.title for issue in issues">
                    <option value="" disabled selected>Select Issue</option>
                  </select>
                </div>
              </div>
              <div class="row">
                <div class="input-field col s12">
                  <textarea id="quote-body-{{$index}}" class="materialize-textarea" ng-model="quote.body" required></textarea>
                  <label for="quote-body-{{$index}}">Body</label>
                </div>
              </div>
              <div class="row">
                <div class="input-field col s12">
                 <input id="quote-source-{{$index}}" type="text" ng-model="quote.source" required>
                 <label for="quote-source-{{$index}}">Source</label>
                </div>
              </div>
            </div>
            <div class="row">
              <button class="btn float-right add-quote-btn" ng-show="$last" ng-click="addNewQuote(candidate)" id="add-quote-btn" type="button">+ Quote</button>
            </div>
          </div>

          <div class="modal-footer">
            <div class="row">
              <button class="modal-action modal-close btn waves-effect" id="modal-cancel" name="action"
              type="reset" ng-click="removeEmptyQuotes(candidate.quotes)">Cancel</button>
              <button class="modal-action modal-close btn waves-effect waves-light" id="modal-save"
              ng-disabled="candidate_form.$invalid" type="submit" name="action" >Save</button>
            </div>
          </div>

        </div>
      </form>

    </div>
  </div>

  <!-- Delete Candidate Verify Modal -->
    <div class="modal" id="delete-cand-modal">
      <div class="modal-content">
        <h4 class="center-align">Are you sure you want to delete this candidate?</h4>
        <h6 class="center-align">Deleting an candidate will also delete all associated candidate quotes.</h6>
          <div class="center-align">
            <button class="modal-action modal-close btn waves-effect" id="cancel-delete" name="action" type="reset" >Cancel</button>
            <button class="modal-action modal-close btn waves-effect waves-light" ng-click="deleteCandidate();" id="delete-button" type="submit" name="action">Delete</button>
          </div>
      </div>
    </div>

</div>
